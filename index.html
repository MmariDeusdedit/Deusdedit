<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./favicon-32x32.png" type="image/png">
    <link rel="stylesheet" href="fonts.css">
    <title>Justin J's Contribution Card</title>
    <script src="./tailwind.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            font-family: Alegreya;
            font-size: 1vh;
        }

        #card {
            max-height: 80vh;
            margin: auto;
            /* background-image: url("./background.png"); */
            background-size: 100%;
            padding: 3rem 3rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            border-radius: 1rem;
        }

        #main {
            font-size: 1.43rem;
            line-height: 3.3rem;
            margin-top: 9.2rem;
        }

        #date {
            display: flex;
        }

        #contr {
/*             font-size: 1.43rem;
            text-align: right; */
        }

        .inputContainer {
            display: flex;
            flex-direction: row;
            justify-content: center;
            padding: 3rem;
        }

        .inputContainer>* {
            margin: auto 1rem;
        }

        #btn {
            color: #aa8f72;
            border-color: #aa8f72;
        }

        span.spacer {
            margin: 10px;
        }
    </style>
</head>

<body>
    <section class="container">
        <div id="card" class="aspect-[0.704838709677419] rounded-[8px]">
            <Img id="backgroundImage"
                style="z-index: -1; position: absolute; top: 0; left: 0; height: 100%; width: 100%; border-radius: 1rem;"
                src="./background-ribbon.png" />
            <!-- <div id="date">
                <div style="flex-basis: auto; display: flex; align-items: center; flex-direction: column;">
                    <div class="date-day" style="font-size: 10rem; color: #aa8f72; line-height: 8.8rem;">18</div>
                    <div class="date-month" style="font-size: 4rem; color: #aa8f72;">MAY</div>
                </div>
            </div> -->
            <div id="main" class="mx-auto text-center">
                <span>Familia ya Bw.  & Bi. Justus Simon Ishengoma wa Kaisho, Kyerwa- </span><br />
                <span>Kagera; Ikishirikiana  na familia ya Prof. & Bi. Deusdedith Simon</span><br />
                <span>Ishengoma wa Kinondoni, Dar es salaam pamoja na familia ya Bw. &</span><br>
                <span>Bi. Boas Moses wa Kibamba , Dar es salaam, </span><br>
                <span>wanayofuraha kukujulisha </span><br>
                <span id="name" style="font-size: 2.1rem; line-height: 50px;">_________________________</span><br />
                <span>kuwa mtoto wao mpendwa</span><br />
                <span style="font-size: 2.1rem; font-style: italic; color: #aa8f72;">Justin Justus Ishengoma</span><br />
                <span> anatarajia kufunga ndoa takatifu tarehe 31 Agosti 2024, Jijini</span><br />
                <span>Dar es salaam. </span><br />
                <div style="padding: 1rem"></div>
                <span>Hivyo ukiwa ndugu, jamaa/rafiki wa familia zetu tunakuomba </span><br/>
                <span>mchango wa hali na mali Ili kufanikisha harusi ya kijana wetu.</span><br/>
                <div style="padding: 1rem"></div>
                <span><span style="color: #a38c6f;">Michango Itumwe:</span> Erick Bazil Sebastian</span><br />
                <span>MPesa: 0763 686 890 <span class="spacer">|</span> Airtel Money: 0684 614 023 <span class="spacer">|</span> CRDB: 0112090904900</span>
            </div>
<!--             <div id="contr">
                <Span style="color: #aa8f72;">Michango Itumwe:</Span><br />
                Mbutolwe Mwakitalu<br />
                Tigo: 0713 236 627<br />
                <br />
                Esther Mbutolwe Mwakitalu<br />
                CRDB: 01J2020341300<br />
            </div> -->
        </div>
    </section>
    <section class="inputContainer mx-auto p-4">
        <button id="btn"
            class="align-middle select-none font-sans font-bold text-center uppercase transition-all disabled:opacity-50 disabled:shadow-none disabled:pointer-events-none text-xs py-3 px-6 rounded-lg border border-gray-900 text-gray-900 hover:opacity-75 focus:ring focus:ring-gray-300 active:opacity-[0.85] flex items-center gap-3"
            type="button">
            Download<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
            </svg>

        </button>
        <input type="text" id="nameInput" placeholder="Insert Invitee's Name Here"
            class="border-b border-blue-gray-200 bg-transparent pt-4 pb-1.5 font-sans text-sm font-normal text-blue-gray-700 outline outline-0 transition-all placeholder-shown:border-blue-gray-200 focus:border-gray-900 focus:outline-0 disabled:border-0 disabled:bg-blue-gray-50">
    </section>
<!--     <section class="inputContainer mx-auto p-4">
        <input type="checkbox" id="addRibbonCheckbox" checked>
        <label for="addRibbonCheckbox">Add Ribbon</label>
    </section> -->

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // Code to configure the text sizes
        // Setting the base 

        let btn = document.getElementById("btn")
        let card = document.getElementById("card")
        let nameInput = document.getElementById("nameInput")
        let name = document.getElementById("name")
        let ribbonCheckbox = document.getElementById("addRibbonCheckbox");
        let backgroundImage = document.getElementById("backgroundImage");
        let options = {
            scale: 1
        }

        document.getElementsByTagName("HTML")[0].style.fontSize = (card.clientHeight / 80) + "px"

        // Preventing iOS from zooming in on the keyboard
        if(navigator.userAgent.indexOf('iPhone') > -1 ){
            document
              .querySelector("[name=viewport]")
              .setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1");
        }

        ribbonCheckbox.addEventListener('change', function() {
            if (ribbonCheckbox.checked) {
                backgroundImage.src = "background-ribbon.png";
            } else {
                backgroundImage.src = "background.png";
            }
        });

        btn.onclick = e => {
            // Storing the original styles that won't look good in the final printed card.
            let unadjustedTransformStyle = card.style.transform
            let unadjustedBorderRadius = backgroundImage.style.borderRadius

            // Adding the sace of the image for quality & removing the border radius for full page viewing
            card.style.transform = "scale(2.5)"
            backgroundImage.style.borderRadius = 0
            
            html2canvas(card).then(function (canvas) {

                canvas.toBlob((blob)=>{
                    let url;
                    if (blob) {
                        url = URL.createObjectURL(blob);
                    } else {
                        // Blob creation failed, revert to base64
                        url = canvas.toDataURL('image/png')
                    }

                    // console.log(canvas.toDataURL('image/png'))
    
                    downloadImage(
                        url,
                        (nameInput.value == "" ? "Empty Invite" : nameInput.value)
                    )

                    URL.revokeObjectURL(url);
                }
                , 'image/png')
            });

            // Restoring the original styles for preview
            card.style.transform = unadjustedTransformStyle;
            backgroundImage.style.borderRadius = unadjustedBorderRadius;
        }

        nameInput.oninput = (e) => {
            name.innerHTML = nameInput.value == "" ? "_________________________" : nameInput.value
        }

        function downloadImage(url, name = "Empty Invite") {
            var link = document.createElement('a');

            link.href = url;
            link.download = `${name}.png`; // Specify the name for the downloaded file

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>

</html>
